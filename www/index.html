<!DOCTYPE html>
<html>
	<head>
		<title>Vue Static Development</title>
		<link rel="stylesheet" type="text/css" href="/assets/app.css" />
	</head>
	<body>

		<div id="app">
			<h1>Hello App!</h1>
			<p>
				<router-link to="/foo">Go to Foo</router-link>
				<router-link to="/bar">Go to Bar</router-link>
				<router-link :to="{ name: 'user', params: { id: 123 }}">Go to User</router-link>
			</p>

			<transition name="fade" mode="out-in">
				<router-view></router-view>
			</transition>
		</div>

		<script type="text/javascript" src="/assets/node_modules/underscore/underscore-min.js"></script>
		<script type="text/javascript" src="/assets/node_modules/jquery/dist/jquery.min.js"></script>
		<script type="text/javascript" src="/assets/node_modules/vue/dist/vue.min.js"></script>
		<script type="text/javascript" src="/assets/node_modules/vue-resource/dist/vue-resource.min.js"></script>
		<script type="text/javascript" src="/assets/node_modules/vue-router/dist/vue-router.min.js"></script>
		<script type="text/javascript" src="/assets/app.js"></script>
		<script>
			jQuery(function($) {

				const Foo = { template: '<div>foo</div>' }
				const Bar = { template: '<div>bar</div>' }
				const Login = { template: '<div>login</div>' }
				const User = { 
					template: '<div>user {{ $route.params.id }} <router-view></router-view></div>',
					watch: {
						'$route': function(to, from) {
							console.log('changing routes');
						}
					}
				}
				const UserProfile = { template: '<div>user profile</div>' }
				const UserAccount = { template: '<div>user account</div>' }
				const UserPosts = { template: '<div>user posts</div>' }

				const routes = [
					{ path: '/foo', name: 'foo', component: Foo },
					{ path: '/bar', name: 'bar', component: Bar },
					{ path: '/login', name: 'login', component: Login },
					{ path: '/user/:id', name: 'user', component: User,
						children: [
							{
								path: 'profile',
								component: UserProfile
							},
							{
								path: 'account',
								component: UserAccount,
								name: 'userAccount',
								meta: { requiresAuth: true }
							},
							{
								path: 'posts',
								component: UserPosts
							}
						] 
					}
				]

				const router = new VueRouter({
					// mode: 'history',
					routes,
					scrollBehavior: function(to, from, savedPosition) {
						return savedPosition ? savedPosition : { x:0, y:0 }
					}
				})

				router.beforeEach(function(to, from, next) {
					console.log({ to, from, next });
					if (to.meta.requiresAuth === true) {
						next({
							name: 'login'
						})
					}
					next()
				});

				const app = new Vue({
					router
				}).$mount('#app');

			});
		</script>

	</body>
</html>